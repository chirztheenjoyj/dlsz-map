-<!doctype html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-823W7XK4TZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-823W7XK4TZ');
</script>
  <meta charset="utf-8" />
  <title>De La Salle Santiago Zobel School Interactive Map — Final Revisions</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
  <style>
    html,body { height:100%; margin:0; font-family: Arial, sans-serif; }
    #map { height: 100vh; }

    /* FABs */
    .fab { position: fixed; background: white; display:flex; align-items:center; justify-content:center; box-shadow:0 6px 18px rgba(0,0,0,0.18); cursor:pointer; z-index:1400; overflow:hidden; }
    /* gallery FAB - rounded square and much larger */
    #galleryFab { width:150px; height:125px; border-radius:14px; bottom:18px; right:18px; border:1px solid black; }
    #galleryFab img { position:absolute; width:100%; height:100%; object-fit:cover; left:0; top:0; opacity:0; transition:opacity 0.9s ease; }
    #galleryFab img.active { opacity:1; }
    #galleryFab .caption { position:absolute; bottom:6px; left:50%; transform:translateX(-50%); background:rgba(255,255,255,0.65); color:#222; padding:2px 8px; border-radius:8px; font-size:12px; text-align:center }

    /* directions & people FABs (icons) */
    #directionsFab, #keyFab { width:64px; height:64px; border-radius:50%; right:18px; }
    #directionsFab { top:18px; }
    #keyFab { top:92px; }

    /* Directions panel (unchanged semantics) */
    .directions { position:absolute; background: rgba(255,255,255,0.95); padding:12px; border-radius:8px; color:#1b3b1b; z-index:1200; max-width:260px; box-shadow:0 6px 18px rgba(0,0,0,0.08); }

    /* Gallery panel */
    #galleryPanel { position:fixed; left:0; right:0; bottom:-300px; height:260px; background:rgba(255,255,255,0.98); border-top:3px solid #2e7d32; z-index:1500; padding:22px 36px; box-sizing:border-box; display:flex; align-items:center; justify-content:center; transition:bottom 0.45s cubic-bezier(.2,.9,.3,1), opacity 0.32s ease; opacity:0; pointer-events:none; }
    #galleryPanel.active { bottom:0; opacity:1; pointer-events:auto; }
    #galleryPanel { position:fixed; }
    .gallery-title { position:absolute; top:10px; left:50%; transform:translateX(-50%); background:#fff; color:#2e7d32; padding:6px 10px; border-radius:10px; font-size:13px; box-shadow:0 6px 18px rgba(0,0,0,0.08); z-index:1510; }

    .carousel-viewport { width:100%; max-width:1100px; overflow:visible; }
    .carousel-track { display:flex; gap:18px; align-items:center; justify-content:center; will-change:transform; }

    .carousel-card { width:260px; height:170px; flex:0 0 260px; border-radius:10px; overflow:hidden; box-shadow:0 6px 16px rgba(0,0,0,0.12); position:relative; transition: transform 0.45s cubic-bezier(.2,.9,.3,1), opacity 0.36s ease; cursor:pointer; }
    .carousel-card img { width:100%; height:100%; object-fit:cover; display:block; }
    .carousel-card .label { position:absolute; left:8px; bottom:8px; background:rgba(0,0,0,0.55); color:white; padding:6px 10px; border-radius:6px; font-size:13px; }

    /* DEFAULT visual state:
       - center is larger & fully opaque
       - side cards are smaller & less opaque
    */
    .carousel-card.side {
      transform: scale(0.92);
      opacity: 0.45;
    }

    .carousel-card.center {
      transform: scale(1.04);
      opacity: 1;
    }

    /* ANIMATION classes used during navigation:
       - anim-center-out: the center card moves left (or right when .rev present), shrinks & fades
       - anim-side-zoom: the side cards zoom a bit and increase opacity but DO NOT translate horizontally
    */
    .carousel-card.anim-center-out {
      /* slides left by default while shrinking & fading */
      transform: translateX(-25px) scale(1.0);
      opacity: 0.5;
      transition: transform 0.42s cubic-bezier(.2,.9,.3,1), opacity 0.38s ease;
    }
    .carousel-card.anim-center-out.rev {
      /* reverse: slide right */
      transform: translateX(-25px) scale(1.0);
    }

    .carousel-card.anim-side-zoom {
      Transform: scale(1.05);
      opacity: 0.95;
      transition: transform 0.42s cubic-bezier(.2,.9,.3,1), opacity 0.38s ease;
    }

    /* Carousel nav - positioned relative to the panel and vertically centered */
    .carousel-nav { position:absolute; top:50%; transform:translateY(-50%); width:64px; height:64px; border-radius:50%; border:none; background:rgba(255,255,255,0.95); color:#2e7d32; font-size:28px; cursor:pointer; box-shadow:0 8px 22px rgba(0,0,0,0.12); z-index:1600; }
    #galleryPrev { left:18px; }
    #galleryNext { right:18px; }

    /* Modal lightbox */
    #infoModal { display:none; opacity:0; position:fixed; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.88); z-index:3000; align-items:center; justify-content:center; transition:opacity 0.28s ease; }
    #infoModal.show { display:flex; opacity:1; }
    .modal-inner { position:relative; width:92%; max-width:1100px; text-align:center; }
    #modalWrapper { position:relative; display:flex; align-items:center; justify-content:center; }
    #modalImg { max-width:92%; max-height:82vh; border-radius:12px; box-shadow:0 12px 30px rgba(0,0,0,0.45); transition: transform 0.42s cubic-bezier(.2,.9,.3,1), opacity 0.36s ease; }
    #modalTitle { color:white; font-size:1.5rem; margin-bottom:12px; text-align:center; }
    #modalInfo { color:#ddd; margin-top:12px; max-width:90%; text-align:center; }

    /* modal side buttons larger */
    .side-btn { position:fixed; top:50%; transform:translateY(-50%); width:72px; height:72px; border-radius:50%; background:rgba(255,255,255,0.12); color:white; border:none; font-size:30px; cursor:pointer; z-index:3500; }
    .side-btn.left { left:14px; }
    .side-btn.right { right:14px; }
    #closeModal { position:absolute; top:14px; right:18px; width:52px; height:52px; border-radius:50%; background:rgba(255,255,255,0.12); color:white; border:none; font-size:20px; z-index:3600; }

    /* popup hover slide/fade (on marker hover) */
    .leaflet-popup-content-wrapper { transition: transform 0.28s ease, opacity 0.28s ease; }
    .leaflet-popup-content-wrapper.pop-float { transform:translateY(-8px); opacity:1; }

    /* Mini close button (appears only when gallery open) */
    #galleryMiniClose {
      position:fixed;
 width:64px; 
height:64px;
      border-radius:8px;
      background:white;
      right:18px;
      bottom:170px;
      border:none;
      box-shadow:0 6px 18px rgba(0,0,0,0.12);
      opacity:0;
      pointer-events:none;
      z-index:1620;
      transition: opacity 0.32s ease, transform 0.32s ease;
      transform: translateY(6px);
      cursor:pointer;
    }
    #galleryMiniClose.show {
      opacity:1;
      pointer-events:auto;
      transform: translateY(0);
    }

    @media (max-width:920px){ .carousel-card{ width:210px; height:140px; } }
    @media (max-width:600px){ .carousel-card{ width:170px; height:110px; } .side-btn{ width:56px; height:56px; font-size:22px; } }
  </style>
</head>
<body>

  <div id="map"></div>

  <!-- FABs -->
  <div id="galleryFab" class="fab" title="Gallery">
    <img id="fabImg0" src="" alt="" />
    <img id="fabImg1" src="" alt="" />
    <div class="caption">Key areas</div>
  </div>
  <button id="galleryMiniClose" title="Close gallery">▲</button>
  <button id="directionsFab" class="fab" title="Directions">🧭</button>
  <div id="keyFab" class="fab" title="Key People">👤</div>

  <!-- Directions panel -->
  <div id="directions-panel" class="directions" style="top:60px; left:10px; display:block;">
    <h4 style="margin:0 0 8px 0;">Directions</h4>
    <ol id="steps" style="padding-left:18px; margin:0; font-size:14px;"></ol>
  </div>

  <!-- Gallery Panel -->
  <div id="galleryPanel">
    <div class="gallery-title">Key Information</div>
    <button class="carousel-nav" id="galleryPrev">◀</button>
    <div class="carousel-viewport">
      <div id="carouselViewport" class="carousel-track"></div>
    </div>
    <button class="carousel-nav" id="galleryNext">▶</button>
  </div>

  <!-- Modal -->
  <div id="infoModal" aria-hidden="true">
    <div class="modal-inner">
      <div id="modalTitle"></div>
      <div id="modalWrapper"><img id="modalImg" src="" alt="" /></div>
      <div id="modalInfo"></div>
      <button id="closeModal">✕</button>
    </div>
    <button id="modalPrev" class="side-btn left">◀</button>
    <button id="modalNext" class="side-btn right">▶</button>
  </div>

  <div id="toast" style="display:none"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
  <script>
    // ===== map setup =====
    const centerCoords = [14.4095, 121.0198];
    const map = L.map('map', { dragging:false, zoomControl:true, scrollWheelZoom:true }).setView(centerCoords, 18);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{ attribution: '&copy; OpenStreetMap contributors' }).addTo(map);

    const userIcon = L.divIcon({ html:'🚶‍♂️', className:'', iconSize:[24,24], iconAnchor:[12,12] });
    const userMarker = L.marker([0,0], { icon:userIcon }).addTo(map);
    map.locate({ setView:false, maxZoom:19, watch: true });
    map.on('locationfound', e => userMarker.setLatLng(e.latlng));

    // ===== data =====
    const buildings = [
      { name: "Sports Pavilion", coords:[14.4102708, 121.0194265], info: "Modern sports venue used for school function and physical education activities." },
      { name: "Julius K. Quiambao Football Field", coords:[14.4104647, 121.0201077], info: "A FIFA-certified turf field" },
      { name: "St. Mutien Marie Administration Building", coords:[14.4097899, 121.0204980], info: "Administration and Registrar offices" },
      { name: "St. La Salle Building", coords:[14.4093200, 121.0201930], info: "Classrooms and offices" },
      { name: "Cadlum Hall & St. Leo Flavius Hall", coords:[14.4096818, 121.0193090], info: "Halls for cafeteria and stalls" },
      { name: "Angelo King Center for Performing Arts", coords:[14.4096396, 121.0196036], info: "The CPA houses the Sylvia P. Lina Theater." },
      { name: "Br. Ceci Hojilla FSC", coords:[14.4087662, 121.0209836], info: "Center for Lasallian Formation"},
      { name: "Our Lady of the Star Chapel", coords:[14.4086150, 121.0206765], info: "The chapel serves as the main spiritual hub for the school community." },
      { name: "St. Joseph Building", coords:[14.410289252625368, 121.01894337355556], info: "STEM and IT facilities."},
      { name: "Taekwondo Gym 3", coords:[14.410508, 121.018902], info: "A multi-use gym" },
      { name: "School Fountain", coords:[14.409468, 121.019594], info: "The central campus landmark." },
      { name: "Debbie Decena Auditorium", coords:[14.409014, 121.020375], info: "Auditorium for events and gatherings." }
    ];

/* === Galleries (fixed names + direct links) === */
const buildingGalleries = {
  "School Fountain": [
    {
      src: "https://i.ibb.co/7hRwrFs/IMG-20250812-145646.jpg",
      desc: "The iconic fountain at the heart of campus, often used as a landmark and meeting place."
    },
    {
      src: "https://i.ibb.co/4RvKCLMX/IMG-20250812-145633.jpg",
      desc: "Another view of the school fountain, showing the surrounding greenery and open space."
    }
  ],

  "Sports Pavilion": [
    {
      src: "https://i.ibb.co/23JN8tq1/pav-exterior.jpg",
      desc: "Under the leadership of Bro. Dennis Magbanua FSC, where the school undertook a major transformation year 2007-2009. It reopened as the modern Sports Pavilion, blending the old structure with a bold new dome addition."
    },
    {
      src: "https://i.ibb.co/KjJqPLPR/SAM-1009.jpg",
      desc: "Used extensively for PE classes, varsity training, and facilities for various sports: basketball, volleyball, futsal, table tennis, judo, dance, and chess."
    },
    {
      src: "https://i.ibb.co/ycMVDD3m/pav-interior.jpg",
      desc: "The Pavilion reflects Lasallian pride, fostering sportsmanship and excellence among students. It also accommodates the entire grade school and high school populations during large gatherings."
    }
  ],

  "Angelo King Center for Performing Arts": [
    {
      src: "https://i.ibb.co/TDzP6dVs/IMG-20250812-145543.jpg",
      desc: "The Angelo King Center for Performing Arts at De La Salle Santiago Zobel (DLSZ) was constructed between 1996 and 2000 through the generous support of philanthropist Mr. Angelo King"
    },
    {
      src: "https://i.ibb.co/XfTtMv2N/6451256-orig.jpg",
      desc: "In 2004, the Cultural Center of the Philippines (CCP) officially recognized the CPA as its Southern Satellite Venue, giving it the nickname “CCP of the South”. The CPA continues to play a central role in arts education, cultural formation, and community performances, making it a true icon in the Lasallian educational mission."
    }
  ],

  "Cadlum Hall & St. Leo Flavius Hall": [
    {
      src: "https://i.ibb.co/7JKWkRGK/IMG-20250812-145529.jpg",
      desc: "Named after St. Leo the Great (Leo Flavius), a Doctor of the Church known for his wisdom, leadership, and theological contributions"
    },
    {
      src: "https://i.ibb.co/Kxp9Y2s5/IMG-20250812-145411.jpg",
      desc: "It is the place that are commemorated for the Lasallian martyrs who were massacred in World War 2 at DLSU on Taft Most Blessed Sacrament Chapel."
    }
  ],

  "DLSZ Football Field": [
    {
      src: "https://i.ibb.co/bj2smjwQ/IMG-20250812-144752.jpg",
      desc: "The facility is renamed Julius Caesar Kindangen Quiambao Football Field in honor of Quiambao’s legacy."
    },
    {
      src: "https://i.ibb.co/8g42CmZ9/IMG-20250812-144741.jpg",
      desc: "Last October 2024, the field becomes the first FIFA Quality Certified pitch at a privately-run K–12 school in the Philippines. Upgrades included premium Limonta Duo Shape 50 mm artificial turf, enhanced drainage, leveled base, and long-term maintenance through E-Sports Intl. Inc."
    },
    {
      src: "https://i.ibb.co/67xPD9LN/IMG-20250812-144616.jpg",
      desc: "Serves as the main training and match venue for DLSZ's football teams (Junior/Senior Archers and Lady Junior Archers), intramurals, and other sports like ultimate frisbee."
    },
    {
      src: "https://i.ibb.co/fdVvqTJ7/IMG-20250812-144553.jpg",
      desc: "It also occasionally hosts tournaments open to external teams and even national squads."
    }
  ],

  "St. Joseph Building": [
    {
      src: "https://i.ibb.co/bjd1yzCn/IMG-20250812-145219.jpg",
      desc: "It was named to honor Saint Joseph, a patron of families and workers. This naming reflects the Lasallian educational philosophy, which emphasizes community, service, and faith as essential pillars of student formation."
    },
    {
      src: "https://i.ibb.co/DHzMmCxx/IMG-20250812-145151.jpg",
      desc: "It was constructed in the late 1980s, during a pivotal period of growth for De La Salle Santiago Zobel School (DLSZ). As one of the earliest permanent structures of DLSZ, it played a foundational role in establishing the school’s physical identity and its commitment to nurturing young learners in a safe and values-centered environment."
    }
  ],

  "Mutien Marie Building": [
    {
      src: "https://i.ibb.co/99wq1943/IMG-20250812-144302.jpg",
      desc: "The building honors St. Mutien Marie Wiaux, a Belgian De La Salle Brother, who was canonized in 1989. Brother Mutien Marie was known for his humble services, discipline, and devotion to teaching students in the arts and religious formation."
    },
    {
      src: "https://i.ibb.co/JwhM0scK/IMG-20250812-144457.jpg",
      desc: "This building serves as the central hub for the campus's administrative operations."
    }
  ],

"St. La Salle Building": [
{
src: "https://i.ibb.co/XH7D6N3/image.png",
desc: "The St. La Salle Building is named after St. John Baptist de La Salle, born on April 30, 1651, the visionary founder of the Institute of the Brothers of the Christian Schools and the recognized Patron Saint of Educators. His legacy in education, particularly his dedication to forming Christian communities through teaching, is deeply reflected in the building’s name and purpose. Moreover, it is established to have a more conducive and suitable learning environment of De La Salle University, the first De La Salle School in the Philippines found in Paco, Manila."
},
{
src: "https://i.ibb.co/qYWD0fdb/IMG-3396.jpg",
desc: "Year 1976, it is the first building that was established to accommodate both elementary and high school classrooms at the campus, it was constructed during the institution’s formative years. Additionally, before the family of Jacobo Santiago Zobel donated the lot at Ayala Alabang, the original name of DLSZ was De La Salle-South School. It is changed in gratitude to Enrique Zobel’s generosity, after his son died at the young age of 11."
}
],

  "Br. Ceci Hojilla FSC (CLF)": [
    {
      src: "https://i.ibb.co/4ZPJCbGp/IMG-20250812-143911.jpg",
      desc: "The Br. Ceci Hojilla FSC Center for Lasallian Formation (CLF), named after the brother who dedicated his life to guiding the youth, was established as a sacred space for deepening the Lasallian identity and strengthening spiritual growth at De La Salle Santiago Zobel (DLSZ). It embodies the school’s mission to raise Christian Achievers for God and Country through values rooted in Faith, Service, and Communion in Mission."
    },
    {
      src: "https://i.ibb.co/jvzr9cKS/IMG-20250812-143953.jpg",
      desc: "CLF was created as a dedicated venue to form students in the Lasallian tradition, centered on the 5Cs: Christian, Committed, Competent, Compassionate, and Confident. All these values are lived out through various Lasallian Formation activities hosted within this facility."
    }
  ],

  "Debbie Decena Auditorium": [
    {
      src: "https://i.ibb.co/1J8TtmrG/IMG-20250812-143555.jpg",
      desc: "This auditorium is dedicated to honor the memory of Deborah \"Debbie\" Decena, Gr. 4 - B student, who died in an accident within the school grounds on 20 November 1998 during the School's 18th Founding Week observance. Presented to the Decena Family on 14 June 2000."
    },
    {
      src: "https://i.ibb.co/GLJ5HnF/IMG-20250812-143610.jpg",
      desc: "Her contributions helped realize the vision of a dedicated space for performing arts, assemblies, and institutional gatherings."
    },
    {
      src: "https://i.ibb.co/cc5zXjmV/IMG-20250812-143627.jpg",
      desc: "Serves as the main auditorium of the DLSZ Alabang campus."
    }
  ],

  "Our Lady of the Star Chapel": [
    {
      src: "https://i.ibb.co/J1BTFp0/OLS-Chapel.jpg",
      desc: "The OLStar Chapel, located on the second floor of the Br. Ceci Hojilla FSC Center for Lasallian Formation (CLF), was purpose-built to provide students and staff with a faith, service, and communion within the school community"
    }
  ]
};
    const keyPeopleGallery = [ { name:"Brother Rafael Donato FSC", src:"https://i.ibb.co/v46N36LY/br-rafe-donato.jpg", desc:"On the year 1997, the school that's was established for underprivileged adults that is originally named as Adult Night High School. Later on, it expanded to include the younger generation which is now known as the Br. Rafael Donato FSC Night High School. In commemoration, each year, the school remembers Br. Rafe every 2nd of November." } ];

    // ===== routing graph & helpers (kept) =====
    const nodeMap = {}, adjacencyList = {};
    buildings.forEach(b => { nodeMap[b.name] = b.coords; adjacencyList[b.name] = []; });
    function addEdge(a,b){ if(!nodeMap[a]||!nodeMap[b]) return; const [la,lo]=nodeMap[a], [lb,lo2]=nodeMap[b]; const dist=Math.hypot(la-lb, lo-lo2); adjacencyList[a].push({node:b,dist}); adjacencyList[b].push({node:a,dist}); }
    addEdge("Sports Pavilion","Taekwondo Gym 3");
    addEdge("Taekwondo Gym 3","St. Joseph Building");
    addEdge("Sports Pavilion","Angelo King Center for Performing Arts");
    addEdge("Angelo King Center for Performing Arts","Cadlum Hall & St. Leo Flavius Hall");
    addEdge("Cadlum Hall & St. Leo Flavius Hall","School Fountain");
    addEdge("School Fountain","St. La Salle Building");
    addEdge("St. La Salle Building","St. Mutien Marie Administration Building");
    addEdge("St. Mutien Marie Administration Building","Br. Ceci Hojilla FSC");
    addEdge("Br. Ceci Hojilla FSC","Our Lady of the Star Chapel");
    addEdge("St. La Salle Building","Julius K. Quiambao Football Field");
    addEdge("Debbie Decena Auditorium","St. Mutien Marie Administration Building");
    addEdge("Debbie Decena Auditorium","St. La Salle Building");

    function dijkstra(s,e){ const dist={}, prev={}; Object.keys(adjacencyList).forEach(n=>{dist[n]=1e9; prev[n]=null;}); dist[s]=0; const Q=Object.keys(dist).slice(); while(Q.length){ Q.sort((a,b)=>dist[a]-dist[b]); const u=Q.shift(); if(u===e) break; adjacencyList[u].forEach(({node:vn, dist:d2})=>{ if(dist[u]+d2<dist[vn]){ dist[vn]=dist[u]+d2; prev[vn]=u; } }); } const path=[]; let u=e; while(u){ path.unshift(u); u=prev[u]; } return path; }
    function getDirection(prevC, current, next){ const angle=(p1,p2)=>Math.atan2(p2[1]-p1[1], p2[0]-p1[0]); const deg=x=>x*(180/Math.PI); const a1=angle(prevC,current), a2=angle(current,next); let delta=deg(a2-a1); delta=((delta+360)%360); if(delta<30||delta>330) return "Go straight"; if(delta>=30&&delta<=150) return "Turn right"; if(delta>=210&&delta<=330) return "Turn left"; return "Continue"; }
    function computeRoute(a,b){ const p=dijkstra(a,b); if(window.routeLayer) map.removeLayer(window.routeLayer); const coords=p.map(n=>nodeMap[n]); window.routeLayer = L.polyline(coords, { color:'#90ee90', weight:5, dashArray:'5,5' }).addTo(map); map.fitBounds(window.routeLayer.getBounds()); const ol=document.getElementById('steps'); ol.innerHTML=''; for(let i=0;i<p.length;i++){ if(i===0) ol.innerHTML += `<li>Start at ${p[i]}</li>`; else if(i===p.length-1) ol.innerHTML += `<li>Arrive at ${p[i]}</li>`; else { const dir = getDirection(nodeMap[p[i-1]], nodeMap[p[i]], nodeMap[p[i+1]]); ol.innerHTML += `<li>${dir} to ${p[i+1]}</li>`; } } document.getElementById('directions-panel').style.display = 'block'; }

    // ===== markers: clicking markers will NOT open gallery; only select routing points. hover popup floats up with fade =====
    let start=null, end=null;
    buildings.forEach(b=>{
      const marker = L.marker(b.coords).addTo(map);
      marker.bindPopup(`<b>${b.name}</b><br>${b.info || ''}`);

      let locked=false;
      marker.on('mouseover', ()=>{
        if(!locked) marker.openPopup();
        setTimeout(()=>{
          const contentWrapper = document.querySelector('.leaflet-popup-content-wrapper'); if(contentWrapper) contentWrapper.classList.add('pop-float');
        }, 10);
      });
      marker.on('mouseout', ()=>{ if(!locked) marker.closePopup(); });
      marker.on('popupclose', ()=>{ locked=false; const contentWrapper = document.querySelector('.leaflet-popup-content-wrapper'); if(contentWrapper) contentWrapper.classList.remove('pop-float'); });

      marker.on('click', ()=>{
        locked = true;
        marker.openPopup();
        // routing selection only
        if(!start){ start = b.name; }
        else if(!end){ end = b.name; if(start === end){ start = end = null; return; } computeRoute(start, end); start = end = null; }
      });
    });

    // ===== modal logic (improved slide + fade) =====
    const modal = document.getElementById('infoModal');
    const modalImg = document.getElementById('modalImg');
    const modalTitle = document.getElementById('modalTitle');
    const modalInfo = document.getElementById('modalInfo');

    let currentGallery = [], galleryIndex = 0, activeBuildingName = '';

    function showModalFromCurrent(){
      if(!currentGallery || !currentGallery.length) return;
      modal.style.display = 'flex';
      // small delay to ensure display:flex applied before opacity transition
      requestAnimationFrame(()=> modal.classList.add('show') );
      setTimeout(()=>{
        modalImg.src = currentGallery[galleryIndex].src;
        modalTitle.textContent = activeBuildingName || '';
        modalInfo.textContent = currentGallery[galleryIndex].desc || '';
      }, 60);
    }

    function openInfoModal(name, index){
      // prefer building gallery; fallback to currentGallery if already set
      const gallery = buildingGalleries[name];
      if(gallery && gallery.length){ currentGallery = gallery.slice(); }
      // if no building gallery and currentGallery empty => nothing
      if(!currentGallery || !currentGallery.length) return;
      galleryIndex = (typeof index === 'number')? Math.max(0, Math.min(index, currentGallery.length-1)) : 0;
      activeBuildingName = name || activeBuildingName || '';
      showModalFromCurrent();
    }

    function closeModal(){
      modal.classList.remove('show');
      setTimeout(()=>{ modal.style.display = 'none'; }, 320);
    }

    // slide transition: current slides out, incoming slides in
    function updateModalImage(direction){
      if(!currentGallery.length) return;
      const next = currentGallery[galleryIndex];
      modalTitle.textContent = activeBuildingName || '';
      modalInfo.textContent = next.desc || '';

      const wrapper = document.getElementById('modalWrapper');
      wrapper.style.position = 'relative';
      const incoming = document.createElement('img');
      incoming.src = next.src;
      incoming.style.position = 'absolute'; incoming.style.left='50%'; incoming.style.top='50%'; incoming.style.transform='translate(-50%,-50%) translateX(120%)';
      incoming.style.maxWidth='92%'; incoming.style.maxHeight='82vh'; incoming.style.borderRadius='12px'; incoming.style.transition='transform 0.42s cubic-bezier(.2,.9,.3,1), opacity 0.36s ease'; incoming.style.opacity='0';
      wrapper.appendChild(incoming);

      requestAnimationFrame(()=>{
        if(direction === 'prev'){
          modalImg.style.transform = 'translateX(120%)';
        } else {
          modalImg.style.transform = 'translateX(-120%)';
        }
        modalImg.style.opacity = '0';
        incoming.style.transform = 'translate(-50%,-50%) translateX(0)';
        incoming.style.opacity = '1';
      });

      setTimeout(()=>{
        modalImg.src = next.src;
        modalImg.style.transform = 'none';
        modalImg.style.opacity = '1';
        if(incoming.parentNode) incoming.parentNode.removeChild(incoming);
      }, 480);
    }

    document.getElementById('modalNext').addEventListener('click', ()=>{
      if(!currentGallery.length) return; galleryIndex = (galleryIndex + 1) % currentGallery.length; updateModalImage('next');
    });
    document.getElementById('modalPrev').addEventListener('click', ()=>{
      if(!currentGallery.length) return; galleryIndex = (galleryIndex - 1 + currentGallery.length) % currentGallery.length; updateModalImage('prev');
    });

    document.getElementById('closeModal').addEventListener('click', closeModal);
    modal.addEventListener('click', (e)=>{ if(e.target === modal) closeModal(); });

    // ===== Carousel (NO autoplay) — smoother morphing & slide animation (fixed) =====
    const places = Object.keys(buildingGalleries);
    let placeIndex = 0;
    const viewportEl = document.getElementById('carouselViewport');
    let isAnimating = false;
    const animDuration = 440; // ms - match CSS transitions

    function makeCard(i, cls) {
      const card = document.createElement('div');
      card.className = `carousel-card ${cls}`;
      const img = document.createElement('img');
      img.src = buildingGalleries[places[i]][0].src;
      img.alt = places[i];
      const label = document.createElement('div');
      label.className = 'label';
      label.textContent = places[i];
      card.appendChild(img);
      card.appendChild(label);

      if (cls === 'center') {
        card.onclick = () => {
          // small click "press" effect then open modal
          card.style.transform = (card.style.transform || '') + ' scale(1.08)';
          setTimeout(() => {
            card.style.transform = ''; // remove inline transform; CSS class sets final state
            openInfoModal(places[i], 0);
          }, 140);
        };
      } else {
        // side cards: clicking them navigates prev/next relative to current placeIndex
        // assign after creation; these will be replaced when we 'updateOnly'
        card.onclick = () => {
          const nextIdx = (placeIndex + 1) % places.length;
          // if the clicked index i equals nextIdx, go next; else (it's prev) go prev
          animateCarousel(i === nextIdx ? 'next' : 'prev');
        };
      }
      return card;
    }

    function renderCarousel(updateOnly = false) {
      if (!places.length) return;
      const prevIdx = (placeIndex - 1 + places.length) % places.length;
      const nextIdx = (placeIndex + 1) % places.length;

      if (updateOnly && viewportEl.children.length === 3) {
        // update existing DOM nodes so transitions appear seamless
        const prevCard = viewportEl.children[0];
        const centerCard = viewportEl.children[1];
        const nextCard = viewportEl.children[2];

        // prev card
        prevCard.className = "carousel-card side";
        prevCard.querySelector("img").src = buildingGalleries[places[prevIdx]][0].src;
        prevCard.querySelector(".label").textContent = places[prevIdx];
        prevCard.onclick = () => animateCarousel('prev');

        // center card
        centerCard.className = "carousel-card center";
        centerCard.querySelector("img").src = buildingGalleries[places[placeIndex]][0].src;
        centerCard.querySelector(".label").textContent = places[placeIndex];
        centerCard.onclick = () => {
          centerCard.style.transform = (centerCard.style.transform || '') + ' scale(1.08)';
          setTimeout(() => { centerCard.style.transform = ''; openInfoModal(places[placeIndex], 0); }, 140);
        };

        // next card
        nextCard.className = "carousel-card side";
        nextCard.querySelector("img").src = buildingGalleries[places[nextIdx]][0].src;
        nextCard.querySelector(".label").textContent = places[nextIdx];
        nextCard.onclick = () => animateCarousel('next');

        return;
      }

      // fresh render (first time)
      viewportEl.innerHTML = '';
      viewportEl.appendChild(makeCard(prevIdx, 'side'));
      viewportEl.appendChild(makeCard(placeIndex, 'center'));
      viewportEl.appendChild(makeCard(nextIdx, 'side'));
    }

    function animateCarousel(dir) {
      if (isAnimating) return;
      if (!places.length) return;
      isAnimating = true;

      // ensure there are 3 nodes
      if (viewportEl.children.length !== 3) { renderCarousel(); }

      const prevEl = viewportEl.children[0];
      const centerEl = viewportEl.children[1];
      const nextEl = viewportEl.children[2];

      const newIndex = (dir === 'next') ? (placeIndex + 1) % places.length : (placeIndex - 1 + places.length) % places.length;

      // add animation classes
      centerEl.classList.add('anim-center-out');
      if (dir === 'prev') centerEl.classList.add('rev'); // slide right when going prev
      // side cards zoom in (but DO NOT translate)
      prevEl.classList.add('anim-side-zoom');
      nextEl.classList.add('anim-side-zoom');

      // after animation: clear anim classes, update index & swap content to show new positions
      setTimeout(() => {
        centerEl.classList.remove('anim-center-out','rev');
        prevEl.classList.remove('anim-side-zoom');
        nextEl.classList.remove('anim-side-zoom');

        placeIndex = newIndex;
        // update the DOM nodes to reflect new prev/center/next (this uses updateOnly path)
        renderCarousel(true);
        // small timeout to ensure CSS updates have taken effect before re-enabling interactions
        setTimeout(()=>{ isAnimating = false; }, 40);
      }, animDuration);
    }

    // touch swipe for carousel
    let touchStartX = 0;
    viewportEl.addEventListener('touchstart', (e)=>{ touchStartX = e.touches[0].clientX; });
    viewportEl.addEventListener('touchend', (e)=>{ const dx = e.changedTouches[0].clientX - touchStartX; if(dx < -40) animateCarousel('next'); else if(dx > 40) animateCarousel('prev'); });

    document.getElementById('galleryPrev').addEventListener('click', ()=>animateCarousel('prev'));
    document.getElementById('galleryNext').addEventListener('click', ()=>animateCarousel('next'));

    // Gallery FAB: show preview images inside the rounded square (small autoplay inside FAB only)
    (function setupGalleryFab(){
      const fab = document.getElementById('galleryFab');
      const imgEls = [document.getElementById('fabImg0'), document.getElementById('fabImg1')];
      const keys = Object.keys(buildingGalleries);
      const preview = [];
      for(let i=0;i<Math.min(6, keys.length); i++){ const g = buildingGalleries[keys[i]]; if(g && g[0]) preview.push(g[0].src); }
      if(preview.length === 0){ imgEls[0].style.opacity=0; }
      else{
        imgEls.forEach((el,i)=>{ el.src = preview[i % preview.length]; if(i===0) el.classList.add('active'); });
        let idx=0;
        setInterval(()=>{
          imgEls[idx%2].classList.remove('active');
          idx = (idx+1) % preview.length;
          imgEls[(idx)%2].src = preview[idx];
          imgEls[(idx)%2].classList.add('active');
        }, 2800);
      }

      const miniClose = document.getElementById('galleryMiniClose');
      const panel = document.getElementById('galleryPanel');

      fab.addEventListener('click', ()=>{
        if(panel.classList.contains('active')){
          panel.classList.remove('active');
          // let the panel slide down, then hide the mini button with a slight delay to allow the gallery to slide
          miniClose.classList.remove('show');
          showToast('Gallery closed');
        }
        else{
          renderCarousel();
          panel.classList.add('active');
          miniClose.classList.add('show');
          showToast('Gallery opened');
        }
      });

      // mini-close simply closes the panel (slide down). we remove .show immediately so it fades
      miniClose.addEventListener('click', ()=>{
        if(!panel.classList.contains('active')) return;
        panel.classList.remove('active');
        miniClose.classList.remove('show');
        showToast('Gallery closed');
      });
    })();

    // Key people FAB: open mini gallery for Brother Rafael Donato
    document.getElementById('keyFab').addEventListener('click', ()=>{
      const p = keyPeopleGallery[0]; if(!p){ showToast('No key people'); return; }
      currentGallery = [{ src: p.src, desc: p.desc }]; galleryIndex = 0; activeBuildingName = p.name; showModalFromCurrent();
    });

    // Directions FAB
    document.getElementById('directionsFab').addEventListener('click', ()=>{ start = end = null; if(window.routeLayer){ map.removeLayer(window.routeLayer); window.routeLayer = null; } document.getElementById('directions-panel').style.display = 'block'; showToast('Directions reset'); });

    // keyboard navigation
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'ArrowLeft'){
        if(modal.classList.contains('show')) document.getElementById('modalPrev').click();
        else if(document.getElementById('galleryPanel').classList.contains('active')) animateCarousel('prev');
      } else if(e.key === 'ArrowRight'){
        if(modal.classList.contains('show')) document.getElementById('modalNext').click();
        else if(document.getElementById('galleryPanel').classList.contains('active')) animateCarousel('next');
      }
    });

    // modal swipe
    let modalTouchStartX=0; document.getElementById('modalImg').addEventListener('touchstart',(e)=>{ modalTouchStartX = e.touches[0].clientX; });
    document.getElementById('modalImg').addEventListener('touchend',(e)=>{ const dx = e.changedTouches[0].clientX - modalTouchStartX; if(dx < -40) document.getElementById('modalNext').click(); else if(dx > 40) document.getElementById('modalPrev').click(); });

    // toast
    function showToast(msg, time=1400){ const t=document.getElementById('toast'); t.textContent=msg; t.style.display='block'; t.classList.add('show'); setTimeout(()=>{ t.classList.remove('show'); setTimeout(()=>t.style.display='none',280); }, time); }

    // initial render
    renderCarousel();

function openGallery() {
  galleryPanel.classList.add("active");
  galleryMiniClose.classList.add("show"); // fade button in
}

function closeGallery() {
  galleryPanel.classList.remove("active");
  galleryMiniClose.classList.remove("show"); // fade button out
}


  </script>
</body>
</html>





